---
import Icon from "./Icon.astro";
---

<div
    id="promo-popup-overlay"
    class="fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-500"
    aria-hidden="true"
>
    <div
        id="promo-popup-content"
        class="relative max-w-4xl w-full mx-4 md:mx-auto transform scale-95 transition-transform duration-500"
    >
        <button
            id="close-popup"
            class="absolute -top-4 -right-4 md:-top-6 md:-right-6 bg-primary-500 text-dark-900 rounded-full p-2 hover:bg-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-500 shadow-lg z-10 transition-colors"
        >
            <Icon name="x" class="w-6 h-6 md:w-8 md:h-8 font-bold" />
            <span class="sr-only">Cerrar</span>
        </button>
        <div
            class="relative overflow-hidden rounded-2xl shadow-2xl border border-white/10 bg-dark-900"
        >
            <img
                src="/images/AP_navidad.webp"
                alt="PromociÃ³n Especial Navidad AmericaPlay"
                class="w-full h-auto object-cover block"
                loading="eager"
            />
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const overlay = document.getElementById("promo-popup-overlay");
        const content = document.getElementById("promo-popup-content");
        const closeBtn = document.getElementById("close-popup");

        // Check if popup has been closed in this session (optional, but good UX - user asked for "appearing" so I'll show it every time for now unless it becomes annoying)
        // Re-reading user request: "que aparezca a 1s de entrar al sitio" - implies every time or per session.
        // I'll stick to showing it every time for now as per specific request "que aparezca a 1s de entrar".

        setTimeout(() => {
            if (overlay) {
                overlay.classList.remove("opacity-0", "pointer-events-none");
                overlay.classList.add("opacity-100", "pointer-events-auto");
                overlay.setAttribute("aria-hidden", "false");
            }
            if (content) {
                content.classList.remove("scale-95");
                content.classList.add("scale-100");
            }
        }, 1000);

        if (closeBtn && overlay) {
            closeBtn.addEventListener("click", () => {
                overlay.classList.remove("opacity-100", "pointer-events-auto");
                overlay.classList.add("opacity-0", "pointer-events-none");
                overlay.setAttribute("aria-hidden", "true");
                if (content) {
                    content.classList.remove("scale-100");
                    content.classList.add("scale-95");
                }
            });

            // Close on click outside
            overlay.addEventListener("click", (e) => {
                if (e.target === overlay) {
                    overlay.classList.remove(
                        "opacity-100",
                        "pointer-events-auto",
                    );
                    overlay.classList.add("opacity-0", "pointer-events-none");
                    overlay.setAttribute("aria-hidden", "true");
                    if (content) {
                        content.classList.remove("scale-100");
                        content.classList.add("scale-95");
                    }
                }
            });
        }
    });
</script>
